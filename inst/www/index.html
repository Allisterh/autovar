<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>Autovar</title>
  <script src="http://code.jquery.com/jquery-1.8.3.js"></script>
  <script src="http://getbootstrap.com/2.3.2/assets/js/bootstrap.js"></script>
  <link href="http://getbootstrap.com/2.3.2/assets/css/bootstrap.css" rel="stylesheet">
  <link href="http://getbootstrap.com/2.3.2/assets/css/bootstrap-responsive.css" rel="stylesheet">
  <script src="dateline.js"></script>
  <style type="text/css">
    textarea {
      font-size: 12px;
      font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
      width: 100%;
      overflow: auto;
      vertical-align: top;
      resize: vertical;
      -webkit-box-sizing: border-box;
      -moz-box-sizing: border-box;
       box-sizing: border-box;
    }
    #outputframe {
      border: 1px lightgray solid;
      width: 100%;
      -webkit-border-radius: 4px;
      -moz-border-radius: 4px;
      border-radius: 4px;
      overflow: auto;
      vertical-align: top;
      resize: vertical;
      -webkit-box-sizing: border-box;
      -moz-box-sizing: border-box;
       box-sizing: border-box;
    }
    #syntax, .dims {
      float: right;
      position: relative;
      right: 0px;
      margin-left: 4px;
    }
    .input-minimini {
      width: 15px;
    }
    .input-prepend {
      margin-bottom: 0px;
    }
    .hide-initially {
      display: none
    }
    .hidealways  {
      display: none
    }
    .autovar-title {
      display: block;
      width: 100%;
      padding: 0;
      margin-bottom: 20px;
      font-size: 21px;
      line-height: 40px;
      color: #333;
      border: 0;
      border-bottom: 1px solid #e5e5e5;
    }
    form {
      margin: 0;
    }
    .on-top {
      width:50%;
      margin: 20px auto;
      display:block;
      box-shadow: 0px 0px 20px #888888;
    }
  </style>
<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 12px;
   margin-top: 16px;
   margin-bottom: 16px;
   padding: 0;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 {
   font-size:2.2em;
}

h2 {
   font-size:1.8em;
}

h3 {
   font-size:1.4em;
}

h4 {
   font-size:1.0em;
}

h5 {
   font-size:0.9em;
}

h6 {
   font-size:0.8em;
}

pre {
   margin-top: 0;
   width: 100%;
   border: 1px solid #ccc;
}

pre code {
   display: block; padding: 0.5em;
}

code.r {
   background-color: rgb(240, 240, 240);
}

code.warning {
   color: #c09853;
}

code.error {
   color: #b94a48;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * {
      background: transparent !important;
      color: black !important;
      filter:none !important;
      -ms-filter: none !important;
   }

   body {
      font-size:12pt;
      max-width:100%;
   }

   a, a:visited {
      text-decoration: underline;
   }

   hr {
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote {
      padding-right: 1em;
      page-break-inside: avoid;
   }

   tr, img {
      page-break-inside: avoid;
   }

   img {
      max-width: 100% !important;
   }

   @page :left {
      margin: 15mm 20mm 15mm 10mm;
   }

   @page :right {
      margin: 15mm 10mm 15mm 20mm;
   }

   p, h2, h3 {
      orphans: 3; widows: 3;
   }

   h2, h3 {
      page-break-after: avoid;
   }
}

</style>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: rgb(88, 72, 246)
   }

   pre .number {
     color: rgb(0, 0, 205);
   }

   pre .comment {
     color: rgb(76, 136, 107);
   }

   pre .keyword {
     color: rgb(0, 0, 255);
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: rgb(3, 106, 7);
   }
   pre {
     background-color: transparent !important;
     border: none !important;
     padding: 0px !important;
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>

</head>
<body>
<div class="container-fluid">
<div class="row-fluid">
<div class="span6">
<div class='form-horizontal'>
<div style='float:right;position:relative;margin-bottom:-20px'>
<span id="version"></span>
|
<a href="/opencpu.html">Other version</a>
|
<a href="https://github.com/roqua/autovar">Source</a>
|
<a href="http://www.cs.rug.nl/~ando/">Contact</a>
</div>
<div class='autovar-title'>Autovar</div>
<div class='tabbable'>
<ul class='nav nav-tabs hide-initially'>
  <li class='active'><a href='#tab1' data-toggle='tab'>Input</a></li>
  <li><a href='#tab2' data-toggle='tab'>Exogenous Variables</a></li>
  <li><a href='#tab3' data-toggle='tab'>Advanced Settings</a></li>
</ul>
<div class='tab-content'>
<div class='tab-pane active' id='tab1'>
<fieldset>
<div class='control-group'>
<label class='control-label' for='filename'>Data set</label>
<div class='controls'>
  <form action="/ocpu/library/autovar/R/opencpu_wrapper/print" target="outputframe" method="POST" id="knitForm">
  <input class="input-file realinputvalue" id="filename" type="file" name="myfilenamearg" />
  <span class='help-block' id='loadingtext'>Select .sav or .dta file containing the data set. </span>
  <div class='hidealways'>
  <textarea name="x" id="x"></textarea>
  <p><a class="btn btn-primary" id="knit"><i class="icon-circle-arrow-right icon-white"></i> Run</a>
  <a class="btn" id="knitdl"><i class="icon-download"></i> Download Results</a>
  <a href="https://github.com/roqua/autovar/blob/master/README.md" id="syntax" target="_blank">View syntax help</a>
  <span class="input-prepend dims">
  <span class="add-on">Fig. height</span>
  <input type="text" id="fhei" class="input-minimini" value="7" />
  </span>
  <span class="input-prepend dims">
  <span class="add-on">Fig. width</span>
  <input type="text" id="fwid" class="input-minimini" value="9" />
  </span>
  </p>
  </div>
  </form>
</div>
<div class='show-initially' style='margin-top:40px'>
    <h2>About</h2>
    <p>Autovar can be used to find VAR models for time series data. Its main functionality is producing a list of VAR models that do not invalidate the model assumptions. Autovar can summarize over the models to provide insight into, e.g., significant contemporaneous correlation and Granger causalities present in the data set.</p>

    <p>While Autovar is available as an <a href="https://github.com/roqua/autovar" target="_blank">R package</a>, part of its functionality is exposed through this web application, running some of the exported Autovar functions (depending on the options selected) and showing the results.</p>


    <h2>Example data sets and use</h2>
    <ul>
      <li><a href="http://autovar.nl/datasets/aug_pp5_da.sav">aug_pp5_da.sav</a></li>
      <li><a href="http://autovar.nl/datasets/Dataset45Jdaggem.dta">Dataset45Jdaggem.dta</a></li>
    </ul>
    <p>To reproduce the results from one of the data sets shown in our JBHI paper, please download the <a href="http://autovar.nl/datasets/Dataset45Jdaggem.dta">Dataset45Jdaggem.dta</a> data set file.
    Load the file in Autovar by clicking "Choose file" above. The UI will then change as it reads the columns from the data set. Set it to select the "Stre" and "Musc" columns as shown below.</p>
    <img src="ui_input.png" class="on-top" />
    <p>Here, we opt to include lag 0 models as well by ticking the box.</p>
    <p>Optionally, we can provide Autovar with some more information about the data set. For example, if we know that this data set describes a study with a single  measurement per day, and the first measurement was completed on the 3rd of March, we can specify this as shown in the image below. Setting timestamps enables Autovar to generate and possibly include dummy variables for days and day parts in its models, to account for cyclity if needed.</p>
    <img src="ui_exogenous_variables.png" class="on-top" />
    <p>Pressing "Run" will then show the output of running a series of functions exported by the Autovar package.</p>
    <p>For the selected settings, Autovar will load the data set using <a href="http://autovar.nl/docs/load_file.html" target="_blank">load_file</a>, add a trend column using <a href="http://autovar.nl/docs/add_trend.html" target="_blank">add_trend</a>, add day dummy columns using <a href="http://autovar.nl/docs/set_timestamps.html" target="_blank">set_timestamps</a>, plot the variables using <a href="http://autovar.nl/docs/visualize.html" target="_blank">visualize</a> (not required), and then look for var models and summarize over then by calling <a href="http://autovar.nl/docs/var_main.html" target="_blank">var_main</a>. The source code for all these functions is publicly available on <a href="https://github.com/roqua/autovar/tree/master/R" target="_blank">GitHub</a>. Please see the <a href="http://autovar.nl/docs" target="_blank">docs</a> section for a full list of available functions.</p>

  <p>Another data set that can be analyzed is presented in <a href="http://autovar.nl/datasets/aug_pp5_da.sav">aug_pp5_da.sav</a>. This data set works with all settings at default. Simply click "Choose file" to select the data set, select "Activity" and "Depression" as VAR columns, and press "Run."</p>
</div>
</div>
<div class='control-group hide-initially'>
<label class='control-label' for='varnames'>VAR columns</label>
<div class='controls'>
  <input type='text' disabled='disabled' id='varnames_line'>
  <select multiple='multiple' id='varnames'></select>
  <span class='help-block'>Select the variables to run VAR on (click while holding down CTRL or &#8984;). Select the original variables only, not the log-transformed variables.</span>
</div>
</div>
<div class='control-group hide-initially'>
<label class='control-label' for='maxlag'>Max. lag</label>
<div class='controls'>
  <input type='text' id='maxlag' value='3'>
  <span class='help-block'>The maximum lag order to consider (typically a multiple of the number of measurements per day).</span>
</div>
</div>
<div class='control-group hide-initially'>
<label class='control-label'>Lag-0 models</label>
<div class='controls'>
  <label class='checkbox'>
    <input type='checkbox' id='include_lag_zero'>Include models at lag 0
  </label>
  <span class='help-block'>Models at lag 0 are actually models at lag 1 with all lag-1 parameters constrained.</span>
</div>
</div>
</fieldset>
</div>
<div class='tab-pane' id='tab2'>
<fieldset class='hide-initially'>
<div class='control-group'>
<label class='control-label'>Trend column</label>
<div class='controls'>
  <label class='checkbox'>
    <input type='checkbox' id='identify_trend' checked='checked'>Include trend variables
  </label>
  <span class='help-block'>Check to create and include a trend variable (named 'index') for models that need a trend according to the Phillips-Perron test.</span>
  <label class='checkbox' style='margin-top:5px;'>
    <input type='checkbox' id='squared_trend'>Include squared trend
  </label>
  <span class='help-block'>For those models that include a trend variable, also include the square of this trend.</span>
</div>
</div>
<div class='control-group'>
<label class='control-label'>Timestamps</label>
<div class='controls'>
  <label class='checkbox'>
    <input type='checkbox' id='set_timestamps'>Set timestamps
  </label>
  <span class='help-block'>Check to create and include dummy variables for weekdays. If the date of the first measurement is known, then check this box and fill out the date below. This causes Autovar to evaluate every model twice: once with and once without dummy variables for weekdays. Additionally, if the number of measurements per day is &gt;1, then dummy variables for day parts are added to all models.</span>
  <label for='timestamp' style='margin-top:5px;'>Date of first measurement</label>
  <input type='text' id='timestamp' placeholder='yyyy-mm-dd'>
  <label for='measurements_per_day'>Measurements per day</label>
  <input type='text' id='measurements_per_day' value='1'>
  <label for='first_measurement_index'>Daypart of first measurement</label>
  <input type='text' id='first_measurement_index' value='1'>
  <span class='help-block'>
    If the first measurement in the data set should not be treated as the first, but as the second or third (etc.) measurement of that day, then specify this here. For example, if "Measurements per day" is set to 3, and "Daypart of first measurement" is set to 2, then the first two measurements in the data set will be tagged with Afternoon and Evening, and the third measurement in the data set will be tagged with Morning of the next day.
  </span>
</div>
</div>
<div class='control-group'>
<label class='control-label' for='exovrs'>Additional exogenous variables</label>
<div class='controls'>
  <input type='text' disabled='disabled' id='exovrs_line'>
  <select multiple='multiple' id='exovrs'></select>
  <span class='help-block'>Select the column names to include as exogenous variables (click while holding down CTRL or &#8984;). Do not select trend variables, weekday dummies, or day part dummies here: use the options above instead. Furthermore, in most cases it's not needed to select outlier columns here either since Autovar generates and uses its own. Thus, only select columns here that provide additional contextual information that cannot be derived from the VAR columns. For example, days during which a patient was working.</span>
</div>
</div>
</fieldset>
</div>
<div class='tab-pane' id='tab3'>
<fieldset class='hide-initially'>
<div class='control-group'>
<label class='control-label'>Outliers</label>
<div class='controls'>
  <label class='checkbox'>
    <input type='checkbox' id='more_outliers'>Exclude more outliers
  </label>
  <span class='help-block'>Use only when you find no models. Enabling this option will find more models but they exclude more data in 'outlier' dummy variables.</span>
</div>
</div>
<div class='control-group'>
<label class='control-label'>Split outliers</label>
<div class='controls'>
  <label class='checkbox'>
    <input type='checkbox' id='split_outliers'>Split up the outliers
  </label>
  <span class='help-block'>To determine whether each outlier should have its own exogenous variable. This will make a difference for restricted models only, and only when there is a variable with multiple outliers.</span>
</div>
</div>
<div class='control-group'>
<label class='control-label'>Normality testing</label>
<div class='controls'>
  <label class='checkbox'>
    <input type='checkbox' id='use_jbtest'>Use jbtest instead of sktest
  </label>
  <span class='help-block'>When checked, Skewness and Kurtosis testing is performed using the Jarque-Bera test instead of the sktest. The Jarque-Bera test is sometimes more strict but potentially incorrect.</span>
</div>
</div>
<div class='control-group'>
<label class='control-label'>Restrictions</label>
<div class='controls'>
  <label class='checkbox'>
    <input type='checkbox' id='lutkepohl_restrictions'>Use simpler restrictions
  </label>
  <span class='help-block'>When checked, a simpler method for finding restrictions is used (no extensive search, no checking of model validity per step).</span>
</div>
</div>
<div class='control-group'>
<label class='control-label'>Model evaluation</label>
<div class='controls'>
  <label class='checkbox'>
    <input type='checkbox' id='use_bic'>Sort output using BIC instead of AIC
  </label>
  <span class='help-block'>When checked, models are assessed by their BIC score instead of their AIC score. This affects the order in which the accepted models are printed and the way in which restrictions are set on the constrained models.</span>
</div>
</div>
<div class='control-group'>
<label class='control-label'>Exclude almost</label>
<div class='controls'>
  <label class='checkbox'>
    <input type='checkbox' id='exclude_almost'>Exclude "almost" Granger causalities
  </label>
  <span class='help-block'>When checked, the system will completely ignore Granger causalities with p-values between 0.05 and 0.10</span>
</div>
</div>
<div class='control-group'>
<label class='control-label'>Stata-like output</label>
<div class='controls'>
  <label class='checkbox'>
    <input type='checkbox' id='format_output_like_stata'>Format output like in Stata
  </label>
  <span class='help-block'>When checked, all constraints and exogenous variables are always shown (i.e., it will now show exogenous variables that were included but constrained in all equations), and the constraints are formatted like in Stata.</span>
</div>
</div>
<div class='control-group'>
<label class='control-label'>Log level</label>
<div class='controls'>
  <label class='radio'>
    <input type='radio' name='logLevelRadios' id='logLevel0' value='0'> 0 = Debug
  </label>
  <label class='radio'>
    <input type='radio' name='logLevelRadios' id='logLevel1' value='1'> 1 = Test detail
  </label>
  <label class='radio'>
    <input type='radio' name='logLevelRadios' id='logLevel2' value='2'> 2 = Test outcomes
  </label>
  <label class='radio'>
    <input type='radio' name='logLevelRadios' id='logLevel3' value='3' checked> 3 = Normal
  </label>
</div>
</div>
</fieldset>
</div>
</div>
</div>
<div class='form-actions hide-initially'>
<button type='submit' class='btn btn-primary' id='runvar'>Run</button>
</div>
<!-- the knitting result will be rendered inside this div -->
</div>
</div>
<div class="span6">
<iframe name="outputframe" id="outputframe" style="display: inline;"></iframe>
<div id="result"></div>
</div>
</div>
</div>
<script>
function postToIframe(target){
	var paramform = $("#knitForm");
  var hasfiles = $("#knitForm").find(".input-file").length > 0;
  paramform.attr("enctype", hasfiles ? "multipart/form-data" : "application/x-www-form-urlencoded");
	paramform.attr("target", target);
	return true;
}
function resizeBoxes() {
    /* LEFT */
    var xheight = $(window).height()-$("#x").offset().top-76;
    $("#x").height(xheight);

    /* RIGHT */
    var outputheight = $(window).height()-$("#outputframe").offset().top-18;
    $("#outputframe").height(outputheight);
}
function add_trend(str) {
  if ($('#identify_trend').is(':checked')) {
    str = str + 'd<-add_trend(d)\n';
  }
  return str;
}
function set_timestamps(str) {
  if ($('#set_timestamps').is(':checked')) {
    var dofmm = $('#timestamp').val();
    var mmpd = $('#measurements_per_day').val();
    if (mmpd == '') { mmpd = 1; }
    var fmmi = $('#first_measurement_index').val();
    if (fmmi == '') { fmmi = 1; }
    str = str + 'd<-set_timestamps(d,date_of_first_measurement="'+dofmm+'",measurements_per_day='+mmpd+',first_measurement_index='+fmmi+')\n'
  }
  return str;
}
function var_main(str) {
  str = str+ 'visualize(d,c('+$('#varnames_line').val()+'))\n'
  str = str+ 'print(system.time({\nd<-var_main(d'
  str = str+ ',vars=c('+$('#varnames_line').val()+')'
  str = str+ ',lag_max='+$('#maxlag').val()
  if ($('#more_outliers').is(':checked')) {
    str = str+ ',exogenous_max_iterations=3'
  }
  if ($('#use_jbtest').is(':checked')) {
    str = str+ ',use_sktest=FALSE'
  }
  if ($('#split_outliers').is(':checked')) {
    str = str+ ',split_up_outliers=TRUE'
  }
  if ($('#lutkepohl_restrictions').is(':checked')) {
    str = str+ ',restrictions.verify_validity_in_every_step=FALSE,restrictions.extensive_search=FALSE'
  }
  if ($('#use_bic').is(':checked')) {
    str = str+ ',criterion="BIC"'
  }
  if ($('#squared_trend').is(':checked') && $('#identify_trend').is(':checked')) {
    str = str+ ',include_squared_trend=TRUE'
  }
  if ($('#include_lag_zero').is(':checked')) {
    str = str+ ',include_lag_zero=TRUE'
  }
  if ($('#exclude_almost').is(':checked')) {
    str = str+ ',exclude_almost=TRUE'
  }
  if ($('#format_output_like_stata').is(':checked')) {
    str = str+ ',format_output_like_stata=TRUE'
  }
  str = str+ ',log_level=' + $('[name=logLevelRadios]:checked').val()
  if ($('#exovrs_line').val() != '') {
    str = str+ ',exogenous_variables=c('+$('#exovrs_line').val()+')'
  }
  str = str+ ')\n}))\n'
  str = str+ 'contemporaneous_correlations_plot(d)\n'
  str = str+ 'var_summary(d,\'\\n\')\n'
  str = str+ 'print_best_models(d)\n'
  return str;
}
function clickRunVar(e) {
  e.preventDefault();
  if ($('#varnames_line').val() == '') { return alert("ERROR: No VAR columns selected."); }
  $('#knitForm').find('textarea[name="x"]').val();
  var str = ''
  str = add_trend(str);
  str = set_timestamps(str);
  str = var_main(str);
  $('#knitForm').find('textarea[name="x"]').val(str);
  $('#knit').click();
}
function disableFields() {
  $('#timestamp,#measurements_per_day,#first_measurement_index').attr('disabled',true);
}
function change_trend() {
  if ($('#identify_trend').is(':checked')) {
    $('#squared_trend').removeAttr('disabled');
  } else {
    $('#squared_trend').attr('disabled',true);
  }
}
function change_timestamps() {
  if ($('#set_timestamps').is(':checked')) {
    $('#timestamp,#measurements_per_day,#first_measurement_index').removeAttr('disabled');
  } else {
    $('#timestamp,#measurements_per_day,#first_measurement_index').attr('disabled',true);
  }
}
function filenameChange() {
  $('#knit,#knitdl,#runvar').addClass('disabled');
  $('#loadingtext').html('Loading...');
  var oldtextarea = $('#knitForm').find('textarea[name="x"]').val();
  $('#knitForm').find('textarea[name="x"]').val("d<-load_file(myfilename,log_level=3);names(d$data[[1]])\n")
  $('#knitForm').attr("action","/ocpu/library/autovar/R/opencpu_wrapper/json");
  $('#knitForm').submit();
  $('#knitForm').find('textarea[name="x"]').val(oldtextarea);
}
function varnamechange() {
  var str = ""
  $('#varnames').find('option:selected').each(function(index,value) {
    if (str == "") {
      str = '"'+$(value).text()+'"'
    } else {
      str = str+', "'+$(value).text()+'"'
    }
  });
  $('#varnames_line').val(str);
}
function exovrschange() {
  var str = ""
  $('#exovrs').find('option:selected').each(function(index,value) {
    if (str == "") {
      str = '"'+$(value).text()+'"'
    } else {
      str = str+', "'+$(value).text()+'"'
    }
  });
  $('#exovrs_line').val(str);
}
$(document).ready(function() {
  $('#runvar').click(clickRunVar);
  disableFields();
$('#filename').change(filenameChange);
$('#varnames').change(varnamechange);
$('#exovrs').change(exovrschange);
$('textarea[name="x"]').attr('value', 'print(d)\n');
$('#set_timestamps').change(change_timestamps);
$('#identify_trend').change(change_trend);
$('#knit').click(function() {
  $('#knit,#knitdl,#runvar').addClass('disabled');
  var oldtextarea = $('#knitForm').find('textarea[name="x"]').val();
  $('#knitForm').find('textarea[name="x"]').val("d<-load_file(myfilename,log_level=3)\n"+oldtextarea)
  $('#knitForm').attr("action","/ocpu/library/autovar/R/opencpu_wrapper/print");
  $('#knitForm').submit();
  $('#knitForm').find('textarea[name="x"]').val(oldtextarea);
});
$('#knitdl').click(function() {
  $('#knit,#knitdl,#runvar').addClass('disabled');
  var oldtextarea = $('#knitForm').find('textarea[name="x"]').val();
  $('#knitForm').find('textarea[name="x"]').val("d<-load_file(myfilename,log_level=3)\n"+oldtextarea+"\nstore_file(d)\n");
  $('#knitForm').attr("action","/ocpu/library/autovar/R/opencpu_wrapper/save");
  $('#knitForm').submit();
  $('#knitForm').find('textarea[name="x"]').val(oldtextarea);
});
$('textarea[name="x"]').bind("keydown", function (e) {
  if (e.keyCode === 13 && e.ctrlKey) {
    e.preventDefault();
    $('#knit').click();
  }
});

/* attach a submit handler to the form */
$('#knitForm').submit(function(event) {
  /* get some values from elements on the page: */
  var $form = $( this ),
      term = $form.find('textarea[name="x"]').val().replace(/\\/g, '\\\\').replace(/"/g, '\\"'),
      fwid = $form.find('input[id="fwid"]').val(),
      fhei = $form.find('input[id="fhei"]').val(),
      url = $form.attr('action'),
      rcode = '{library(autovar); library(knitr); library(markdown);' +
              'sub(".*<body>(.*)</body>.*", "\\\\1", ' +
              'markdownToHTML(text = knit(text = "```{r,fig.width='+fwid+',fig.height='+fhei+'}\n' + term + '\n```\n")))}';
  if ($('#knitForm').attr("action") == "/ocpu/library/autovar/R/opencpu_wrapper/json") {
    rcode = '{library(autovar);'+term+'}';
  }
  /* Send the data using post and put the results in a div */
  $('textarea[name="x"]').attr('value',rcode);
  $("#outputframe").replaceWith('<iframe name="outputframe" id="outputframe"></iframe>');
  resizeBoxes();
  $('#outputframe').load(function() {
    $('#knit,#knitdl,#runvar').removeClass('disabled');
    var data = $("#outputframe").contents().find("body").text();
    if ($('#knitForm').attr("action") == "/ocpu/library/autovar/R/opencpu_wrapper/save") {
      var cont = data.replace(/(\/ocpu\/tmp\/[^/]+\/(.*))\n/gm,'<a href="$1">$2</a><br/>\n');
      $("#outputframe").contents().find("body").html(cont);
    } else if ($('#knitForm').attr("action") == "/ocpu/library/autovar/R/opencpu_wrapper/json") {
      data = eval(data);
      $('#varnames,#exovrs').html('');
      $('#varnames_line,#exovrs_line').val('');
      $.each(data, function(i, value) {
        $('#varnames,#exovrs').append($('<option>').text(value).attr('value', value));
      });
      $('#varnames,#exovrs').attr('size',Math.min($('#varnames')[0].length,10));
      $('#loadingtext').html('Select .sav or .dta file containing the data set.');
      $('.hide-initially').removeClass('hide-initially');
      $('.show-initially').hide();
      resizeBoxes();
    } else {
      if (data.substring(0,4) == "[1] ") {
        data = data.substring(4,data.length);
      }
      if (data.indexOf("<pre>") != -1) {
        data = data.replace(/(<code)(>## Warning: )/g,'$1 class=\\"warning\\"$2');
        data = data.replace(/(<code)(>## Error: )/g,'$1 class=\\"error\\"$2');
        data = data.replace(/(<code>|\\n)## /gm,'$1');
        $("#outputframe").contents().find("body").html(eval(data));
      } else {
        $("#outputframe").contents().find("body").html(data);
      }
    }
    $("style, link[rel='stylesheet']").each(function(i,e) {
      $("#outputframe").contents().find("body").append($(e).clone());
    });
    $("#outputframe").contents().find("pre code").each(function(i, e) {hljs.highlightBlock(e)});
    $("#outputframe").contents().find("body").css('padding-left','8px').css('padding-right','8px');
  });
  postToIframe("outputframe");
});
$(window).resize(resizeBoxes);
resizeBoxes();
});
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-41094656-1', 'autovar.nl');
  ga('send', 'pageview');

</script>
</body>
</html>
